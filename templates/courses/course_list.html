{% extends "base.html" %}
{% block title %}Courses · StudyWithKimy{% endblock %}
{% block content %}
<section class="mb-8">
  <div class="flex items-center justify-between">
    {% if user.is_authenticated and user.role == 'teacher' %}
      <a href="{% url 'course_add' %}" class="btn-primary">Create course</a>
    {% endif %}
    <div>
      <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Browse Courses</h1>
      <p class="mt-1 text-slate-600">Find something new to learn today.</p>
    </div>
    <a href="/dashboard/" class="btn-ghost">My learning</a>
  </div>

  <!-- Search / Filters -->
  <form method="get" action="/courses/" class="mt-6 grid grid-cols-1 sm:grid-cols-[1fr_auto] gap-3">
    <input class="input" type="search" name="q" value="{{ request.GET.q }}" placeholder="Search courses, topics, instructors…">
    <button class="btn-primary" type="submit">Search</button>
  </form>
</section>

{% with items=page_obj.object_list|default:courses %}
  <section class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3">
    {% for c in items %}
      <article class="card overflow-hidden group">
        {% if c.thumbnail %}
          <img src="{{ c.thumbnail.url }}" alt="" class="h-28 w-full object-cover">
        {% else %}
          <div class="h-28 w-full bg-gradient-to-br from-blue-50 to-indigo-50"></div>
        {% endif %}
        <div class="p-5">
          <h2 class="font-semibold group-hover:text-blue-700 transition-colors">{{ c.title }}</h2>
          {% if c.teacher %}
            <p class="text-xs text-slate-500 mt-1">by {{ c.teacher.get_full_name|default:c.teacher.username }}</p>
          {% endif %}
          <p class="mt-2 text-sm text-slate-600 line-clamp-3">{{ c.short_description|default:c.description|truncatewords:28 }}</p>
          <div class="mt-4 flex items-center justify-between">
            <a href="/courses/{{ c.slug }}/" class="btn-primary">View course</a>
            {% if c.category %}
              <span class="tag">{{ c.category }}</span>
            {% endif %}
          </div>
        </div>
      </article>
    {% empty %}
      <div class="col-span-full card p-6 text-slate-600">No courses found.</div>
    {% endfor %}
  </section>
{% endwith %}

<!-- Pagination (if page_obj is supplied) -->
{% if page_obj %}
  <nav class="mt-8 flex items-center justify-between">
    <div class="text-sm text-slate-600">
      Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    </div>
    <div class="flex items-center gap-2">
      {% if page_obj.has_previous %}
        <a class="btn-ghost" href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}page={{ page_obj.previous_page_number }}">Previous</a>
      {% endif %}
      {% if page_obj.has_next %}
        <a class="btn-ghost" href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}page={{ page_obj.next_page_number }}">Next</a>
      {% endif %}
    </div>
  </nav>
{% endif %}
{% endblock %}
